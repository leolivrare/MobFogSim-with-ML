# PFG-UNICAMP: Integration of Machine Learning with the MobFogSim Simulator

## Overview

This project aims to enable the integration of Machine Learning (ML) models with the **MobFogSim** simulator, allowing, for instance, support for decision-making processes such as migration decisions in fog computing environments. Additionally, the project investigates the functionality of federated learning, leveraging the simulator's IoT-based scenario. This context creates an ideal environment for collaborative federated learning experiments among simulated devices. The study on federated learning uses the **Flower** framework, a robust and suitable tool to achieve the objectives of this project.

The project comprises three main components:

1. **MobFogSim Simulator**: A fork of the [original MobFogSim](https://github.com/diogomg/MobFogSim), enhanced with support for ML-based decision-making.
2. **Federated Learning Module**: A framework for training ML models using logs from simulated devices in a federated learning setup.
3. **ML Integration API**: An API to load trained ML models and integrate them into the decision-making process of MobFogSim.

While the ML model used in this project is deliberately simple to streamline experimentation, the system is fully equipped to handle more complex models.

---

## Project Modules

### 1. MobFogSim Simulator

**MobFogSim** is a powerful simulator for modeling mobility and migration in fog computing. Developed as an extension of the **iFogSim** framework, it incorporates mobility features, enabling researchers to simulate scenarios involving mobile devices and the migration of resources between fog nodes.

- **Fork Details**: This project is a fork of the [MobFogSim repository](https://github.com/diogomg/MobFogSim). The simulator code in the `MobFogSim/` directory remains largely unchanged from the original project. All credit goes to the authors of the simulator and their detailed work in enabling fog and edge computing research.
  
- **Enhancements**:
  1. **Improved Logging**: Device-level logs are now generated to support federated learning. These logs provide granular data about each device, including mobility and migration decisions.
  2. **ML-Based Decision Making**: The migration decision-making logic has been extended to include interactions with an external ML model through the **ML Integration API**.

For a deeper understanding of MobFogSim, refer to the [original paper](https://www.sciencedirect.com/science/article/abs/pii/S1569190X19301935?via%3Dihub).

A detailed guide to running and using the simulator is available in the `MobFogSim/README.md`.

---

### 2. Federated Learning Module

This module provides a framework for federated training of ML models using data from simulated devices.

- **Logs as Data**: Device logs generated by MobFogSim serve as the input data for training. Each device's logs correspond to a federated client.
- **Federated Learning with Flower**: The [Flower framework](https://flower.dev) enables decentralized training, with clients sharing only model parameters and keeping their raw data private.
- **Notebook**: All implementation details and explanations are documented in the `ml_simple_model_training/PFG_modelo_federado.ipynb` notebook. It guides users through:
  - Data preprocessing.
  - Federated training workflow.
  - Saving trained models for integration with the API.

> **Note**: Although the ML model used in the notebook is simple, the modular design allows integration of more sophisticated models.

---

### 3. ML Integration API

The **ML Integration API** bridges the trained ML models and the MobFogSim simulator, enabling dynamic, ML-driven decision-making during simulation runs.

- **Features**:
  - Loads a trained ML model (e.g., the one from the federated learning module).
  - Serves predictions via an HTTP RESTful API.
  - Integrates seamlessly with MobFogSim for migration decision-making.

- **Components**:
  - `api.py`: Core API logic, using FastAPI.
  - `Dockerfile`: Enables containerized deployment of the API.
  - `logs.txt`: Captures detailed logs of API requests and responses for debugging and analysis.

For setup and usage instructions, refer to the `mobfogsim_migration_api/README.md`.

---

## How the Modules Interact

1. **Simulator Generates Logs**: MobFogSim produces detailed logs of each device's activity, including data on mobility, proximity, and migration decisions.
2. **Federated Learning**: Logs are used to train ML models via federated learning in the notebook.
3. **Model Integration**: Trained ML models are loaded into the API, which interacts with MobFogSim to influence migration decisions.

This modular architecture ensures flexibility, enabling researchers to:
- Replace the ML model with more complex alternatives.
- Modify the federated training process.
- Experiment with new decision-making strategies in the simulator.

---

## Credits and References

- **MobFogSim Authors**: This project builds upon the work of the [MobFogSim](https://github.com/diogomg/MobFogSim) team. All simulator code in the `MobFogSim/` directory is derived from their repository.
- **Federated Learning with Flower**: The federated learning setup is powered by the [Flower framework](https://flower.dev).
- **Documentation and Implementation**:
  - Federated learning: `ml_simple_model_training/PFG_modelo_federado.ipynb`.
  - API: `mobfogsim_migration_api/README.md`.
  - Simulator: `MobFogSim/README.md`.

For any questions or issues, feel free to raise an issue in this repository or contact the project maintainers.
